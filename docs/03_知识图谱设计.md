# 知识图谱设计方案

## 一、图谱概述

### 1.1 设计目标
构建央企穿透式监督知识图谱，支持以下业务场景：
1. **风险传导监督**: 追踪法律事件对企业及其关联方的影响
2. **循环交易监督**: 检测企业间的循环交易模式

### 1.2 图谱规模
- **节点总数**: 290个
  - 人员节点: 80个
  - 公司节点: 90个
  - 合同节点: 100个
  - 法律事件节点: 20个

- **边总数**: 435条
  - 法人代表关系: 90条
  - 控股关系: 15条
  - 合同签署关系: 200条
  - 交易关系: 100条
  - 法律事件关联: 30条

---

## 二、节点设计

### 2.1 人员节点 (Person)

**节点标签**: `Person`

**数据来源**: `t_sec_user_虚拟数据.csv`

**节点属性**:
| 属性名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| node_id | string | 节点唯一标识 | USER_001 |
| node_type | string | 节点类型 | Person |
| name | string | 姓名 | 张伟 |
| number | string | 工号 | EMP0001 |
| id_card | string | 证件号码 | 310101199001011234 |
| gender | string | 性别 | 1:男 2:女 |
| birthday | string | 出生日期 | 1990-01-01 |
| status | string | 数据状态 | C:已审核 |

**业务用途**:
- 作为公司的法人代表
- 作为案件的经办人
- 风险传导的起点（如被限高人员）

---

### 2.2 公司节点 (Company)

**节点标签**: `Company`

**数据来源**: 
- `t_org_org_虚拟数据.csv` (组织)
- `t_bd_supplier_虚拟数据.csv` (供应商)
- `t_bd_customer_虚拟数据.csv` (客户)
- `t_mscon_counterpart_虚拟数据.csv` (其他相对方)

**节点属性**:
| 属性名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| node_id | string | 节点唯一标识 | ORG_001 |
| node_type | string | 节点类型 | Company |
| company_type | string | 公司类型 | Organization/Supplier/Customer/Counterpart |
| name | string | 公司名称 | 中央建设集团有限公司 |
| number | string | 编码 | ORG001 |
| legal_person | string | 法人代表 | 张伟 |
| credit_code | string | 统一社会信用代码 | 91110000MA001234XX |
| establish_date | string | 成立日期 | 2010-05-20 |
| status | string | 数据状态 | C:已审核 |
| description | string | 描述 | 公司详细描述 |

**公司类型说明**:
- **Organization**: 央企组织（来自t_org_org）
- **Supplier**: 供应商（来自t_bd_supplier）
- **Customer**: 客户（来自t_bd_customer）
- **Counterpart**: 其他相对方（来自t_mscon_counterpart）

**业务用途**:
- 合同签署主体
- 交易关系主体
- 控股关系主体
- 风险传导路径节点

---

### 2.3 合同节点 (Contract)

**节点标签**: `Contract`

**数据来源**: `t_mscon_contract_虚拟数据.csv`

**节点属性**:
| 属性名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| node_id | string | 节点唯一标识 | CON_001 |
| node_type | string | 节点类型 | Contract |
| contract_no | string | 合同编号 | HT2024000001 |
| contract_name | string | 合同名称 | 建材采购合同-华信建材有限公司 |
| amount | string | 签约金额 | 5000000.00 |
| sign_date | string | 签订日期 | 2024-06-15 |
| status | string | 合同状态 | EXECUTING:执行中 COMPLETED:已完成 |
| description | string | 描述 | 合同详细描述 |

**业务用途**:
- 连接公司的中介节点
- 交易金额的载体
- 循环交易检测的关键节点
- 法律事件的关联对象

---

### 2.4 法律事件节点 (LegalEvent)

**节点标签**: `LegalEvent`

**数据来源**: 
- `t_conl_case_虚拟数据.csv` (案件)
- `t_conl_disputeregist_虚拟数据.csv` (纠纷)

**节点属性**:
| 属性名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| node_id | string | 节点唯一标识 | CASE_001 |
| node_type | string | 节点类型 | LegalEvent |
| event_type | string | 事件类型 | Case:案件 Dispute:纠纷 |
| event_no | string | 事件编号 | AJ202400001 |
| event_name | string | 事件名称 | 合同纠纷案件-1 |
| amount | string | 涉及金额 | 1500000.00 |
| status | string | 事件状态 | F:已立案 I:一审 N:已结案 |
| register_date | string | 登记日期 | 2024-03-15 |
| description | string | 描述 | 事件详细描述 |

**业务用途**:
- 风险传导的起点
- 关联人员和合同
- 风险预警的触发源

---

## 三、边设计

### 3.1 法人代表关系 (LEGAL_PERSON)

**边类型**: `LEGAL_PERSON`

**方向**: Person → Company

**数据来源**: 
- 组织表的FARTIFICIALPERSON字段
- 供应商表的FARTIFICIALPERSON字段
- 客户表的FARTIFICIALPERSON字段
- 其他相对方表的FARTIFICIALPERSON字段

**边属性**:
| 属性名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| edge_id | string | 边唯一标识 | LP_0001 |
| edge_type | string | 边类型 | LEGAL_PERSON |
| from_node | string | 起始节点ID | USER_001 |
| to_node | string | 目标节点ID | ORG_001 |
| from_type | string | 起始节点类型 | Person |
| to_type | string | 目标节点类型 | Company |
| properties | string | 边属性 | 法人代表关系-中央建设集团有限公司 |

**业务用途**:
- 追踪人员对公司的控制关系
- 风险传导：人员被限高 → 影响其担任法人的公司

**数据量**: 90条

---

### 3.2 控股关系 (CONTROLS)

**边类型**: `CONTROLS`

**方向**: Company → Company

**数据来源**: 组织表的FPARENTORGID字段

**边属性**:
| 属性名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| edge_id | string | 边唯一标识 | CTRL_0001 |
| edge_type | string | 边类型 | CONTROLS |
| from_node | string | 起始节点ID (父公司) | ORG_001 |
| to_node | string | 目标节点ID (子公司) | ORG_002 |
| from_type | string | 起始节点类型 | Company |
| to_type | string | 目标节点类型 | Company |
| properties | string | 边属性 | 控股关系 |

**业务用途**:
- 追踪公司的控股结构
- 风险传导：母公司风险 → 影响子公司

**数据量**: 15条

**控股结构示例**:
```
ORG_001 (中央建设集团)
  ├─ ORG_002 (中建华东分公司)
  ├─ ORG_003 (中建华南分公司)
  └─ ORG_004 (中建西部分公司)

ORG_005 (国家电网集团)
  ├─ ORG_006 (国网华北电力)
  ├─ ORG_007 (国网华中电力)
  └─ ORG_008 (国网华南电力)
```

---

### 3.3 合同签署关系 (PARTY_A/B/C/D)

**边类型**: `PARTY_A`, `PARTY_B`, `PARTY_C`, `PARTY_D`

**方向**: Company → Contract

**数据来源**: 合同表的FPARTAID/FPARTBID/FPARTCID/FPARTDID字段

**边属性**:
| 属性名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| edge_id | string | 边唯一标识 | PARTY_0001 |
| edge_type | string | 边类型 | PARTY_A/PARTY_B/PARTY_C/PARTY_D |
| from_node | string | 起始节点ID (公司) | ORG_002 |
| to_node | string | 目标节点ID (合同) | CON_001 |
| from_type | string | 起始节点类型 | Company |
| to_type | string | 目标节点类型 | Contract |
| properties | string | 边属性 | 甲方-中建华东分公司 |

**业务用途**:
- 标识公司在合同中的角色（甲方/乙方/丙方/丁方）
- 追踪公司签订的所有合同
- 合同关系分析

**数据量**: 200条
- PARTY_A: 100条（每个合同都有甲方）
- PARTY_B: 100条（每个合同都有乙方）
- PARTY_C: 0条（本数据集中无丙方）
- PARTY_D: 0条（本数据集中无丁方）

---

### 3.4 交易关系 (TRADES_WITH)

**边类型**: `TRADES_WITH`

**方向**: Company → Company

**数据来源**: 从合同表推导（甲方 → 乙方）

**边属性**:
| 属性名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| edge_id | string | 边唯一标识 | TRADE_0001 |
| edge_type | string | 边类型 | TRADES_WITH |
| from_node | string | 起始节点ID (甲方) | ORG_002 |
| to_node | string | 目标节点ID (乙方) | SUP_001 |
| from_type | string | 起始节点类型 | Company |
| to_type | string | 目标节点类型 | Company |
| properties | string | 边属性 | 交易金额:5000000.00,合同:HT2024000001 |

**业务用途**:
- **循环交易检测**: 检测公司间的交易闭环
- 交易网络分析
- 资金流向追踪

**数据量**: 100条

**循环交易示例**:
```
场景：ORG_005 → SUP_011 → CUS_001 → ORG_005
- 合同1: ORG_005 → SUP_011 (金额: 10,000,000)
- 合同2: SUP_011 → CUS_001 (金额: 10,050,000)
- 合同3: CUS_001 → ORG_005 (金额: 9,980,000)
→ 金额相似度 > 95%，触发预警
```

---

### 3.5 法律事件关联关系

#### 3.5.1 案件关联人员 (INVOLVED_IN)

**边类型**: `INVOLVED_IN`

**方向**: Person → LegalEvent

**数据来源**: 案件表的FOPERATORID字段

**边属性**:
| 属性名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| edge_id | string | 边唯一标识 | CASE_P_0001 |
| edge_type | string | 边类型 | INVOLVED_IN |
| from_node | string | 起始节点ID (人员) | USER_001 |
| to_node | string | 目标节点ID (案件) | CASE_001 |
| from_type | string | 起始节点类型 | Person |
| to_type | string | 目标节点类型 | LegalEvent |
| properties | string | 边属性 | 经办人-张伟 |

**业务用途**:
- 追踪人员涉及的法律事件
- 风险传导：人员 → 法律事件 → 关联公司

**数据量**: 10条

---

#### 3.5.2 法律事件关联合同 (RELATED_TO)

**边类型**: `RELATED_TO`

**方向**: Contract → LegalEvent

**数据来源**:
- 案件表的FRELATECONTRACTID字段
- 纠纷表的FRELATECONTRACTID字段

**边属性**:
| 属性名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| edge_id | string | 边唯一标识 | CASE_C_0001 |
| edge_type | string | 边类型 | RELATED_TO |
| from_node | string | 起始节点ID (合同) | CON_001 |
| to_node | string | 目标节点ID (法律事件) | CASE_001 |
| from_type | string | 起始节点类型 | Contract |
| to_type | string | 目标节点类型 | LegalEvent |
| properties | string | 边属性 | 关联合同-建材采购合同 |

**业务用途**:
- 追踪合同引发的法律事件
- 风险传导：合同 → 法律事件 → 合同签署方

**数据量**: 20条
- 案件关联合同: 10条
- 纠纷关联合同: 10条

---

## 四、业务场景实现

### 4.1 场景1：风险传导监督

**场景描述**: 某公司的法人代表被限高，追踪对其控股公司及交易对手的影响。

**图谱路径**:
```
Person (被限高)
  → [LEGAL_PERSON] →
Company_A (母公司)
  → [CONTROLS] →
Company_B (子公司)
  → [PARTY_A] →
Contract_X
  → [PARTY_B] ←
Company_C (交易对手)
```

**查询逻辑**:
1. 查找被限高人员（通过LegalEvent节点）
2. 通过LEGAL_PERSON关系找到该人员担任法人的公司
3. 通过CONTROLS关系找到该公司控股的子公司
4. 通过PARTY_A关系找到子公司签订的合同
5. 通过PARTY_B关系找到合同的交易对手
6. 生成风险预警：提醒交易对手注意风险

**数据支持**:
- 10条风险传导场景合同（ORG_002的子公司与供应商签订）
- 15条控股关系
- 10条案件数据（涉及关键人员）

---

### 4.2 场景2：循环交易监督

**场景描述**: 检测公司间的循环交易模式，金额相似度高则触发预警。

**图谱路径**:
```
Company_A
  → [TRADES_WITH] →
Company_B
  → [TRADES_WITH] →
Company_C
  → [TRADES_WITH] →
Company_A (形成闭环)
```

**查询逻辑**:
1. 从任意公司出发，通过TRADES_WITH关系遍历
2. 检测是否形成闭环（回到起始公司）
3. 提取闭环中所有交易的金额
4. 计算金额相似度
5. 如果相似度 > 90%，触发预警

**数据支持**:
- 3条循环交易合同（ORG_005 → SUP_011 → CUS_001 → ORG_005）
- 金额设计：10,000,000 / 10,050,000 / 9,980,000（相似度 > 95%）

---

## 五、图谱文件说明

### 5.1 节点文件

| 文件名 | 节点类型 | 记录数 | 说明 |
|--------|----------|--------|------|
| nodes_person.csv | Person | 80 | 人员节点 |
| nodes_company.csv | Company | 90 | 公司节点（整合4个表） |
| nodes_contract.csv | Contract | 100 | 合同节点 |
| nodes_legal_event.csv | LegalEvent | 20 | 法律事件节点（整合案件+纠纷） |

### 5.2 边文件

| 文件名 | 边类型 | 记录数 | 说明 |
|--------|--------|--------|------|
| edges_legal_person.csv | LEGAL_PERSON | 90 | 法人代表关系 |
| edges_controls.csv | CONTROLS | 15 | 控股关系 |
| edges_party.csv | PARTY_A/B/C/D | 200 | 合同签署关系 |
| edges_trades_with.csv | TRADES_WITH | 100 | 交易关系 |
| edges_case_person.csv | INVOLVED_IN | 10 | 案件关联人员 |
| edges_case_contract.csv | RELATED_TO | 10 | 案件关联合同 |
| edges_dispute_contract.csv | RELATED_TO | 10 | 纠纷关联合同 |

---

## 六、图谱导入指南

### 6.1 Nebula Graph导入

**创建图空间**:
```ngql
CREATE SPACE enterprise_supervision (
  partition_num = 10,
  replica_factor = 1,
  vid_type = FIXED_STRING(20)
);

USE enterprise_supervision;
```

**创建节点Tag**:
```ngql
CREATE TAG Person (
  name string,
  number string,
  id_card string,
  gender string,
  birthday string,
  status string
);

CREATE TAG Company (
  company_type string,
  name string,
  number string,
  legal_person string,
  credit_code string,
  establish_date string,
  status string,
  description string
);

CREATE TAG Contract (
  contract_no string,
  contract_name string,
  amount string,
  sign_date string,
  status string,
  description string
);

CREATE TAG LegalEvent (
  event_type string,
  event_no string,
  event_name string,
  amount string,
  status string,
  register_date string,
  description string
);
```

**创建边Edge**:
```ngql
CREATE EDGE LEGAL_PERSON (properties string);
CREATE EDGE CONTROLS (properties string);
CREATE EDGE PARTY_A (properties string);
CREATE EDGE PARTY_B (properties string);
CREATE EDGE PARTY_C (properties string);
CREATE EDGE PARTY_D (properties string);
CREATE EDGE TRADES_WITH (properties string);
CREATE EDGE INVOLVED_IN (properties string);
CREATE EDGE RELATED_TO (properties string);
```

**导入数据**:
使用Nebula Importer工具，配置CSV文件路径，批量导入节点和边数据。

