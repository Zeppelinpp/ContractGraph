# 央企穿透式监督知识图谱原型系统

## 一、系统概述

基于 Nebula Graph 图数据库构建央企穿透式监督知识图谱，支持五类高级分析场景：

1. **FraudRank 欺诈风险传导分析**：基于 PageRank 算法，计算企业的欺诈风险传导分数
2. **高级循环交易检测**：检测分散-汇聚模式的复杂循环交易
3. **空壳公司网络识别**：识别具有空壳公司特征的企业网络
4. **关联方串通网络分析**：检测关联方串通网络，包括轮流中标、围标等模式
5. **履约关联风险检测**：识别合同履约风险，排查关联相对方的潜在风险

---

## 二、知识图谱设计

### 2.1 节点类型

#### Person（人员节点）
| 属性 | 说明 | 示例 |
|------|------|------|
| node_id | 节点ID | USER_001 |
| name | 姓名 | 张伟 |
| number | 工号 | EMP0001 |
| id_card | 证件号码 | 310101199001011234 |
| gender | 性别 | 1:男 2:女 |
| birthday | 出生日期 | 1990-01-01 |
| status | 状态 | C:已审核 |

#### Company（公司节点）
| 属性 | 说明 | 示例 |
|------|------|------|
| node_id | 节点ID | ORG_001 |
| name | 公司名称 | 中央建设集团有限公司 |
| number | 编码 | ORG001 |
| legal_person | 法人代表 | 张伟 |
| credit_code | 社会信用代码 | 91110000MA001234XX |
| establish_date | 成立日期 | 2010-05-20 |
| status | 状态 | C:已审核 |
| description | 描述 | 公司详细描述 |

**注意**：公司类型通过关系边（IS_SUPPLIER、IS_CUSTOMER等）来表达，不再使用 company_type 属性

#### Contract（合同节点）
| 属性 | 说明 | 示例 |
|------|------|------|
| node_id | 节点ID | CON_001 |
| contract_no | 合同编号 | HT2024000001 |
| contract_name | 合同名称 | 建材采购合同-华信建材有限公司 |
| amount | 签约金额 | 5000000.00 |
| sign_date | 签订日期 | 2024-06-15 |
| status | 状态 | EXECUTING:执行中 COMPLETED:已完成 |

#### LegalEvent（法律事件节点）
| 属性 | 说明 | 示例 |
|------|------|------|
| node_id | 节点ID | CASE_001 |
| event_type | 事件类型 | Case:案件 Dispute:纠纷 |
| event_no | 事件编号 | AJ202400001 |
| event_name | 事件名称 | 合同纠纷案件-1 |
| amount | 涉及金额 | 1500000.00 |
| status | 状态 | F:已立案 I:一审 N:已结案 J:执行 |
| register_date | 登记日期 | 2024-03-15 |
| description | 描述 | 事件详细描述 |

#### Transaction（交易节点）【新增】
| 属性 | 说明 | 示例 |
|------|------|------|
| node_id | 节点ID | TXN_IN_0001 |
| transaction_type | 交易类型 | INFLOW:流入 OUTFLOW:流出 |
| transaction_no | 交易单号 | IN2024000001 |
| contract_no | 关联合同号 | HT2024000001 |
| amount | 交易金额 | 2500000.00 |
| transaction_date | 交易日期 | 2025-09-20 |
| status | 状态 | C:已完成 |
| fpaidamount | 已履约金额 | 1898679.00 |
| ftotalamount | 应履约金额 | 2675136.00 |
| fbiztimeend | 履约截止日期 | 2026-04-02 |
| fperformstatus | 履约状态 | A:待履约 B:履约中 C:已履约 |

### 2.2 边类型

| 边类型 | 方向 | 说明 | 数量 |
|--------|------|------|------|
| LEGAL_PERSON | Person → Company | 法人代表关系 | 90 |
| CONTROLS | Company → Company | 控股关系 | 15 |
| PARTY_A/B/C/D | Company → Contract | 合同签署关系（甲乙丙丁方） | 200 |
| TRADES_WITH | Company → Company | 交易关系 | 100 |
| IS_SUPPLIER | Company → Company | 供应商关系 | 43 |
| IS_CUSTOMER | Company → Company | 客户关系 | 73 |
| PAYS | Company → Transaction | 支付关系 | 60 |
| RECEIVES | Transaction → Company | 收款关系 | 60 |
| INVOLVED_IN | Person → LegalEvent | 人员涉及法律事件 | 10 |
| RELATED_TO | Contract → LegalEvent | 合同关联法律事件 | 20 |

### 2.3 控股结构示例

```
中央建设集团有限公司 (ORG_001)
  ├─ 中建华东分公司
  ├─ 中建华南分公司
  └─ 中建西部分公司

中国石油天然气集团 (ORG_005)
  ├─ 中石油华东销售公司
  ├─ 中石油华南销售公司
  └─ 中国铁路工程集团
```

---

## 三、Mock数据设计

### 3.1 数据来源

| 数据表 | 节点/边类型 | 数量 |
|--------|-------------|------|
| t_sec_user | Person | 80 |
| t_org_org | Company (Organization) | 25 |
| t_bd_supplier | Company (Supplier) | 30 |
| t_bd_customer | Company (Customer) | 20 |
| t_mscon_counterpart | Company (Counterpart) | 15 |
| t_mscon_contract | Contract | 100 |
| t_mscon_performplanin | Transaction (INFLOW) | 30 |
| t_mscon_performplanout | Transaction (OUTFLOW) | 30 |
| t_conl_case | LegalEvent (Case) | 10 |
| t_conl_disputeregist | LegalEvent (Dispute) | 10 |

### 3.2 场景数据设计

#### 场景一：循环交易

设计了一个三方循环交易，金额高度相似：

| 交易方向 | 金额（元） |
|----------|-----------|
| 华润置地发展 → 国家电网集团公司 | 9,994,149.00 |
| 国家电网集团公司 → 中天建筑材料 | 9,919,290.00 |
| 中天建筑材料 → 华润置地发展 | 9,902,595.00 |

**金额相似度**：99.60%（基于变异系数计算）

#### 场景二：法律风险传导

设计了一条多层级风险传导路径：

```
人员: 胡芳 (USER_009)
  ↓ [LEGAL_PERSON]
母公司: 中国石油天然气集团
  ↓ [CONTROLS]
子公司: 中石油华东销售公司、中石油华南销售公司、中国铁路工程集团（3家）
  ↓ [PARTY_A]
合同: 10份合作合同
  ↓ [PARTY_B]
交易对手: 14家公司

法律事件: 债权债务案件-9（状态：F-已立案）
```

---

## 四、高级分析场景

### 4.1 FraudRank 欺诈风险传导分析

基于 PageRank 算法，通过分析企业间的关联关系（控股、法人、交易、合同等），识别风险从高风险企业向关联企业传导的模式。

**核心特性**：
- 初始风险分数：基于法律事件（案件、争议）计算，考虑事件类型、金额、状态
- 边权重设计：不同关系类型的风险传导权重（CONTROLS: 0.8, LEGAL_PERSON: 0.75等）
- 风险等级：高风险(≥0.7)、中风险(≥0.4)、低风险(≥0.2)、正常(<0.2)

**输出**：`reports/fraud_rank_report.csv` - 包含公司ID、名称、风险分数、风险等级等

---

### 4.2 高级循环交易检测（分散-汇聚模式）

检测复杂的循环交易模式，识别资金从核心公司分散到多个公司，再通过关联关系汇聚回核心公司或其关联公司的可疑模式。

**核心特性**：
- 分散节点数量：资金分散到的公司数量
- 流入流出相似度：≥70%为可疑
- 时间窗口：默认180天
- 金额阈值：默认50万以上

**输出**：`reports/circular_trade_detection_report.csv` - 包含核心公司、分散节点、金额、相似度、风险分数等

---

### 4.3 空壳公司网络识别

识别具有空壳公司特征的企业网络，通过分析资金穿透率、交易速度、交易对手多样性、法人关联等特征。

**核心特性**：
- 资金穿透率：≥0.9 高嫌疑
- 交易速度：<7天 高嫌疑
- 交易对手多样性：<0.2 高嫌疑
- 法人关联公司数量：≥5 高嫌疑
- 空壳公司分数：≥0.6 为高嫌疑

**输出**：`reports/shell_company_detection_report.csv` - 包含公司信息、空壳分数、各项特征指标等

---

### 4.4 关联方串通网络分析

检测关联方串通网络，识别包括轮流中标、围标等可疑行为模式。

**核心特性**：
- 轮换分数：检测是否存在规律的轮流中标
- 金额相似度：合同金额的变异系数
- 卡阈值比例：合同金额刻意卡在审批阈值附近的比例
- 网络密度：关联关系的紧密程度

**输出**：`reports/collusion_network_report.csv` - 包含网络ID、公司数量、风险分数、轮换分数等

---

### 4.5 履约关联风险检测

根据相对方获取签署履约状态的合同存在收款逾期或交货逾期的情况，排查并列出同一相对方或存在相关关系的相对方的相同标的名称的其他合同。

**核心特性**：
- 逾期类型：收款逾期、交货逾期、收款逾期+交货逾期
- 关联相对方：通过 TRADES_WITH、IS_SUPPLIER、IS_CUSTOMER、CONTROLS 关系识别
- 风险分数：综合考虑逾期交易数量、风险合同比例、风险合同总金额

**输出**：`reports/perform_risk_report.csv` - 包含公司信息、风险分数、逾期交易数、风险合同列表等

---

## 五、执行效果验证

### 5.1 循环交易监测（基础场景）

**检测结果**：

```
============================================================
循环交易监测 Demo
============================================================
✓ 成功连接到 Nebula Graph
正在检测循环交易模式...
检测到 3 个可疑的循环交易模式:

[1]
循环交易检测到闭环:
起始公司: 华润置地发展
交易路径: 华润置地发展 -> 华润置地发展 -> 国家电网集团公司 -> 中天建筑材料 -> 华润置地发展
交易金额: 9,994,149.00, 9,919,290.00, 9,902,595.00
金额相似度: 99.60%
循环长度: 3 个节点
⚠️  预警: 金额相似度超过90%，疑似循环交易！

[2]
循环交易检测到闭环:
起始公司: 国家电网集团公司
交易路径: 国家电网集团公司 -> 国家电网集团公司 -> 中天建筑材料 -> 华润置地发展 -> 国家电网集团公司
交易金额: 9,919,290.00, 9,902,595.00, 9,994,149.00
金额相似度: 99.60%
循环长度: 3 个节点
⚠️  预警: 金额相似度超过90%，疑似循环交易！

[3]
循环交易检测到闭环:
起始公司: 中天建筑材料
交易路径: 中天建筑材料 -> 中天建筑材料 -> 华润置地发展 -> 国家电网集团公司 -> 中天建筑材料
交易金额: 9,902,595.00, 9,994,149.00, 9,919,290.00
金额相似度: 99.60%
循环长度: 3 个节点
⚠️  预警: 金额相似度超过90%，疑似循环交易！
```

**检测算法**：
- 图遍历算法：深度优先搜索（DFS）
- 相似度计算：基于变异系数（CV = 标准差 / 平均值，相似度 = (1 - CV) × 100%）
- 预警阈值：相似度 ≥ 90%

**结果说明**：
- 检测到3条循环路径（同一循环的不同起点）
- 每条路径均正确显示公司名称、交易金额
- 金额相似度计算准确（99.60%）
- 触发预警逻辑正常

---

### 5.2 法律风险传导监测（基础场景）

**检测结果示例一**：

```
============================================================
法律事件监测 Demo
============================================================
✓ 成功连接到 Nebula Graph
正在查找涉及法律事件的人员...
找到 10 个涉及法律事件的人员

正在分析: 胡芳 (债权债务案件-9)...
  该人员担任 1 家公司的法人代表

============================================================
风险传导监测报告
============================================================
涉及人员: 胡芳 (USER_009)
法律事件: 债权债务案件-9 (Case)
事件状态: F

发现 11 条风险传导路径:

[路径 1]
USER_009 --[LEGAL_PERSON]--> 中国石油天然气集团 --[CONTROLS]--> 中国石油天然气集团 --[PARTY]--> 中国石油天然气集团与工程测绘服务合作合同 --[PARTY]--> 工程测绘服务

[路径 2]
USER_009 --[LEGAL_PERSON]--> 中国石油天然气集团 --[CONTROLS]--> 中国石油天然气集团 --[PARTY]--> 中国石油天然气集团与环境影响评价合作合同 --[PARTY]--> 环境影响评价

[路径 3]
USER_009 --[LEGAL_PERSON]--> 中国石油天然气集团 --[CONTROLS]--> 中国石油天然气集团 --[PARTY]--> 中国石油天然气集团与恒大地产集团合作合同 --[PARTY]--> 恒大地产集团

[路径 4]
USER_009 --[LEGAL_PERSON]--> 中国石油天然气集团 --[CONTROLS]--> 中石油华东销售公司 --[PARTY]--> 中石油华东销售公司与建筑法律咨询合作合同 --[PARTY]--> 建筑法律咨询

[路径 5]
USER_009 --[LEGAL_PERSON]--> 中国石油天然气集团 --[CONTROLS]--> 中石油华南销售公司 --[PARTY]--> 中石油华南销售公司与工程保险代理合作合同 --[PARTY]--> 工程保险代理

[路径 6]
USER_009 --[LEGAL_PERSON]--> 中国石油天然气集团 --[CONTROLS]--> 中石油华南销售公司 --[PARTY]--> 中石油华南销售公司与中建设计研究院合作合同 --[PARTY]--> 中建设计研究院

[路径 7]
USER_009 --[LEGAL_PERSON]--> 中国石油天然气集团 --[CONTROLS]--> 中石油华南销售公司 --[PARTY]--> 中石油华南销售公司与博达工程机械合作合同 --[PARTY]--> 博达工程机械

[路径 8]
USER_009 --[LEGAL_PERSON]--> 中国石油天然气集团 --[CONTROLS]--> 中国铁路工程集团 --[PARTY]--> 中国铁路工程集团与荣盛发展合作合同 --[PARTY]--> 荣盛发展

[路径 9]
USER_009 --[LEGAL_PERSON]--> 中国石油天然气集团 --[CONTROLS]--> 中国铁路工程集团 --[PARTY]--> 中国铁路工程集团与建筑安全评估合作合同 --[PARTY]--> 建筑安全评估

[路径 10]
USER_009 --[LEGAL_PERSON]--> 中国石油天然气集团 --[CONTROLS]--> 中国铁路工程集团 --[PARTY]--> 中国铁路工程集团与瑞祥机电设备合作合同 --[PARTY]--> 瑞祥机电设备

[路径 11]
USER_009 --[LEGAL_PERSON]--> 中国石油天然气集团 --[CONTROLS]--> 中国铁路工程集团 --[PARTY]--> 中国铁路工程集团与建筑法律咨询合作合同 --[PARTY]--> 建筑法律咨询

风险影响范围:
- 受影响公司数量: 14
- 受影响合同数量: 10

受影响公司列表:
  - 建筑法律咨询
  - 环境影响评价
  - 中国石油天然气集团
  - 恒大地产集团
  - 中国铁路工程集团
  - 博达工程机械
  - 工程保险代理
  - 建筑安全评估
  - 中石油华东销售公司
  - 中石油华南销售公司
  - 工程测绘服务
  - 中建设计研究院
  - 荣盛发展
  - 瑞祥机电设备

受影响合同列表:
  - 中国石油天然气集团与环境影响评价合作合同
  - 中石油华东销售公司与建筑法律咨询合作合同
  - 中国铁路工程集团与荣盛发展合作合同
  - 中国铁路工程集团与瑞祥机电设备合作合同
  - 中国石油天然气集团与工程测绘服务合作合同
  - 中国铁路工程集团与建筑安全评估合作合同
  - 中石油华南销售公司与中建设计研究院合作合同
  - 中石油华南销售公司与博达工程机械合作合同
  - 中国石油天然气集团与恒大地产集团合作合同
  - 中石油华南销售公司与工程保险代理合作合同

⚠️  风险预警: 建议对上述公司和合同进行风险评估！
```

**检测结果示例二**：

```
正在分析: 赵伟 (债权债务案件-4)...
  该人员担任 1 家公司的法人代表

============================================================
风险传导监测报告
============================================================
涉及人员: 赵伟 (USER_004)
法律事件: 债权债务案件-4 (Case)
事件状态: J

发现 1 条风险传导路径:

[路径 1]
USER_004 --[LEGAL_PERSON]--> 中建西部分公司 --[CONTROLS]--> 中建西部分公司 --[PARTY]--> 中建西部分公司与建筑安全评估合作合同 --[PARTY]--> 建筑安全评估

风险影响范围:
- 受影响公司数量: 2
- 受影响合同数量: 1

受影响公司列表:
  - 中建西部分公司
  - 建筑安全评估

受影响合同列表:
  - 中建西部分公司与建筑安全评估合作合同

⚠️  风险预警: 建议对上述公司和合同进行风险评估！
```

**检测结果示例三**：

```
正在分析: 朱秀兰 (合同纠纷案件-1)...
  该人员担任 1 家公司的法人代表

============================================================
风险传导监测报告
============================================================
涉及人员: 朱秀兰 (USER_001)
法律事件: 合同纠纷案件-1 (Case)
事件状态: N

发现 20 条风险传导路径:

[路径 1]
USER_001 --[LEGAL_PERSON]--> 中央建设集团有限公司 --[CONTROLS]--> 中央建设集团有限公司 --[PARTY]--> 中央建设集团有限公司与恒大地产集团合作合同 --[PARTY]--> 恒大地产集团

[路径 2]
USER_001 --[LEGAL_PERSON]--> 中央建设集团有限公司 --[CONTROLS]--> 中央建设集团有限公司 --[PARTY]--> 中央建设集团有限公司与博瑞工程设备合作合同 --[PARTY]--> 博瑞工程设备

[路径 3]
USER_001 --[LEGAL_PERSON]--> 中央建设集团有限公司 --[CONTROLS]--> 中央建设集团有限公司 --[PARTY]--> 中央建设集团有限公司与中建设计研究院合作合同 --[PARTY]--> 中建设计研究院

[路径 4]
USER_001 --[LEGAL_PERSON]--> 中央建设集团有限公司 --[CONTROLS]--> 中央建设集团有限公司 --[PARTY]--> 中央建设集团有限公司与东方钢铁集团合作合同 --[PARTY]--> 东方钢铁集团

[路径 5]
USER_001 --[LEGAL_PERSON]--> 中央建设集团有限公司 --[CONTROLS]--> 中央建设集团有限公司 --[PARTY]--> 中央建设集团有限公司与工程保险代理合作合同 --[PARTY]--> 工程保险代理

[路径 6]
USER_001 --[LEGAL_PERSON]--> 中央建设集团有限公司 --[CONTROLS]--> 中建华东分公司 --[PARTY]--> 中建华东分公司与腾飞机械设备合作合同 --[PARTY]--> 腾飞机械设备

[路径 7]
USER_001 --[LEGAL_PERSON]--> 中央建设集团有限公司 --[CONTROLS]--> 中建华东分公司 --[PARTY]--> 建材采购合同-永盛钢构工程 --[PARTY]--> 永盛钢构工程

[路径 8]
USER_001 --[LEGAL_PERSON]--> 中央建设集团有限公司 --[CONTROLS]--> 中建华东分公司 --[PARTY]--> 中建华东分公司与工程测绘服务合作合同 --[PARTY]--> 工程测绘服务

[路径 9]
USER_001 --[LEGAL_PERSON]--> 中央建设集团有限公司 --[CONTROLS]--> 中建华东分公司 --[PARTY]--> 建材采购合同-天成电气设备 --[PARTY]--> 天成电气设备

[路径 10]
USER_001 --[LEGAL_PERSON]--> 中央建设集团有限公司 --[CONTROLS]--> 中建华东分公司 --[PARTY]--> 建材采购合同-金石建材供应 --[PARTY]--> 金石建材供应

... (省略10条路径)

风险影响范围:
- 受影响公司数量: 12
- 受影响合同数量: 10

受影响公司列表:
  - 金石建材供应
  - 恒大地产集团
  - 中建华东分公司
  - 东方钢铁集团
  - 中央建设集团有限公司
  - 工程保险代理
  - 腾飞机械设备
  - 天成电气设备
  - 博瑞工程设备
  - 中建设计研究院
  - 工程测绘服务
  - 永盛钢构工程

受影响合同列表:
  - 中建华东分公司与工程测绘服务合作合同
  - 建材采购合同-天成电气设备
  - 中央建设集团有限公司与博瑞工程设备合作合同
  - 中央建设集团有限公司与中建设计研究院合作合同
  - 建材采购合同-金石建材供应
  - 中央建设集团有限公司与东方钢铁集团合作合同
  - 建材采购合同-永盛钢构工程
  - 中央建设集团有限公司与工程保险代理合作合同
  - 中央建设集团有限公司与恒大地产集团合作合同
  - 中建华东分公司与腾飞机械设备合作合同

⚠️  风险预警: 建议对上述公司和合同进行风险评估！
```

**检测算法**：
- 路径追踪：Person → LegalEvent → Company → Contract → Company
- 关系扩展：通过 CONTROLS 关系从母公司扩展到子公司
- 影响范围统计：去重后统计受影响的公司和合同数量

**结果说明**：
- 共检测10个涉及法律事件的人员
- 不同人员的影响范围差异明显：
  - 胡芳（大型集团法人）：11条路径，影响14家公司、10份合同
  - 朱秀兰（大型集团法人）：20条路径，影响12家公司、10份合同
  - 赵伟（分公司法人）：1条路径，影响2家公司、1份合同
- 所有路径均正确显示节点名称和关系类型

---

---

## 六、运行方式

### 单独运行分析场景

```bash
# FraudRank 分析
uv run python -m src.analysis.fraud_rank

# 循环交易检测
uv run python -m src.analysis.circular_trade

# 空壳公司识别
uv run python -m src.analysis.shell_company

# 串通网络分析
uv run python -m src.analysis.collusion

# 履约风险检测
uv run python -m src.analysis.perform_risk
```

### 批量运行所有分析

```bash
uv run python -m src.analysis.run_all_analysis
```

### 报告输出位置

所有分析报告均保存在 `reports/` 目录下：
- `fraud_rank_report.csv` - 欺诈风险传导分析报告
- `circular_trade_detection_report.csv` - 循环交易检测报告
- `shell_company_detection_report.csv` - 空壳公司识别报告
- `collusion_network_report.csv` - 串通网络分析报告
- `perform_risk_report.csv` - 履约风险检测报告

---

**文档版本**：v2.0  
**更新日期**：2025-01-XX
